# Nomenclature Traefik

Stack containers labels & ports

## Noms des services

Suffix√©s automatiquement, pas besoin de gestion.

## Ports

10000 / Ok
20000 / Ok
30000 / Ok

80 & 443 / HTTP & HTTPS access, reserved for Traefik
10000+ / Core services & stacks (monitoring, etc.)
15000+ / Tests
20000+ / Clients, each got a range of 100 ports

Pas besoin de sp√©cifier le port (si publication automatique sur 80 OU un seul port ouvert ??).

Ne pas sp√©cifier, laisser le bousin se g√©rer automatiquement

## Labels

Tests si conflits

- Les routeurs doivent √™tre uniques, sinon KO
- Les services (eg. load balancers) doivent √™tre uniques, SINON AFFICHAGE ALEATOIRE DU CONTENEUR parmis ceux pr√©sents sur le load balancer

R√®gles:

- (camelCase)
- Pr√©fixer http ou https
  - http sera redirig√© vers https syst√©matiquement via traefik
- Pr√©fixer du sous domaine  + nom du site + extension + "_"
- Pr√©fixer du nom du service + "_"
- Type traefik
- (Index) si plusieurs services ou routeurs..

```yaml
- "traefik.http.routers.helloworld.rule=Host(`test.masamune.fr`)"
- "traefik.http.routers.helloworld.service=helloworld666"
- "traefik.http.services.helloworld666.loadbalancer.server.port=80"

# DEVIENT

- "traefik.http.routers.https_testMasamuneFr_Helloworld_Router.rule=Host(`test.masamune.fr`)"
- "traefik.http.routers.https_testMasamuneFr_Helloworld_Router.service=https_testMasamuneFr_Helloworld_Service"
- "traefik.http.services.https_testMasamuneFr_Helloworld_Service.loadbalancer.server.port=80"
```

## Core Named volumes

### core-traefik-https

Contains traefik auto-generated https certificates in ~/home/https/acme.json

Note: the acme.json MUST BE generated by traefik, can't just touch & chown it.

- Chown the https folder
- üìå Let it create the acme.json file, then chown back the folder to root
  - chmod 600 acme.json , cf [tuto tt en bas](https://github.com/containous/blog-posts/blob/master/2019_09_10-101_docker/docker-compose-09.yml)

### core-traefik-logs

Contains Traefik both debug & access logs

- /home/logs/traefik-access.log
- /home/logs/traefik-debug.log
